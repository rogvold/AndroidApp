package com.cardiomood.math.histogram;

/**
 * Created by danon on 19.02.14.
 */
public class Histogram128Ext extends Histogram {

    private static final double STEP = 1000.0/128.0;

    private double HRVTi;
    private double WN1;
    private double WN5;
    private  double WN10;


    public Histogram128Ext(double[] values) {
        super(values, STEP);
        init();
    }



    private void init() {
        int height = getHeight();
        HRVTi = ((double) values.length) / ((double) height);
        WN1 = getWN(1.0);
        WN5 = getWN(5.0);
        WN10 = getWN(10.0);
    }

    public double getWN(double percent) {
        int target = (int) Math.floor(values.length*percent/100);
        int min = 0;
        int max = (int) Math.floor(getAMo()*values.length/100);
        int x = 0;
        do {
            x = (max + min) / 2;
            int c = getCountBelow(x);
            if (c < target)
                min = x + 1;
            else if (c > target)
                max = x;
            else break;
        } while (max > min);
        x = (max + min) / 2;
        return getWidthAbove(x);
    }

    public double getWN1() {
        return WN1;
    }

    public double getWN5() {
        return WN5;
    }

    public double getWN10() {
        return WN10;
    }

    public double getHRVTi() {
        return HRVTi;
    }

    private int getCountBelow(int x) {
        int sum = 0;
        for (int c: count) {
            if (c < x)
                sum += c;
        }
        return sum;
    }


    public static void main(String[] args) {
        long t = System.currentTimeMillis();
//        double intervals[] = new double[] {
//                844 , 838, 756, 806, 790, 734, 795, 832, 874, 790, 808, 790, 753, 746, 730, 670, 706, 695, 689, 745, 752, 752, 703, 690, 685, 674, 712, 747, 818, 785, 796, 835, 718, 920, 861, 772, 761, 786, 837, 747, 756, 747, 895, 733, 969, 946, 784, 766, 861, 768, 799, 765, 748, 800, 895, 761, 780, 778, 937, 873, 733, 772, 757, 868, 820, 815, 726, 741, 847, 800, 712, 843, 833, 695, 829, 749, 777, 795, 750, 773, 719, 695, 694, 726, 747, 783, 817, 812, 738, 687, 682, 687, 733, 795, 776, 741, 800, 839, 898, 915, 725, 916, 864, 859, 708, 867, 825, 812, 806, 831, 844, 685, 714, 700, 667, 765, 866, 785, 841, 709, 917, 829, 683, 798, 707, 647, 619, 630, 635, 735, 856, 865, 696, 856, 691, 877, 687, 810, 647, 617, 600, 636, 699, 736, 844, 868, 858, 841, 739, 848, 686, 893, 668, 832, 778, 722, 672, 633, 622, 620, 640, 630, 594, 568, 572, 591, 625, 669, 665, 630, 611, 601, 596, 593, 579, 577, 575, 584, 599, 588, 594, 598, 622, 637, 628, 623, 626, 620, 606, 584, 581, 584, 629, 668, 690, 712, 635, 654, 657, 884, 838, 673, 765, 653, 670, 696, 678, 695, 662, 716, 705, 666, 713, 689, 694, 630, 646, 602, 597, 585, 582, 600, 624, 604, 606, 591, 572, 563, 559, 563, 558, 548, 539, 536, 533, 525, 518, 518, 521, 517, 510, 503, 502, 511, 515, 522, 510, 501, 495, 492, 493, 491, 492, 495, 500, 498, 495, 491, 496, 499, 501, 497, 497, 497, 503, 509, 510, 507, 504, 510, 524, 524, 528, 525, 528, 526, 529, 529, 529, 525, 519, 534, 547, 556, 550, 547, 553, 556, 549, 541, 535, 538, 553, 584, 687, 718, 672, 687, 685, 643, 617, 603, 598, 623, 627, 617, 630, 688, 767, 742, 707, 703, 666, 712, 669, 655, 651, 644, 659, 656, 666, 674, 695, 656, 656, 642, 639, 632, 658, 660, 653, 623, 619, 608, 625, 613, 630, 630, 600, 590, 586, 595, 588, 597, 602, 624, 595, 563, 558, 566, 600, 640, 641, 602, 592, 598, 626, 653, 655, 712, 725, 799, 720, 716, 834, 648, 697, 758, 632, 646, 702, 755, 769, 784, 771, 714, 758, 751, 739, 706, 725, 680, 651, 697, 658, 656, 670, 660, 671, 642, 646, 646, 657, 628, 621, 609, 625, 641, 664, 684, 673, 640, 644, 615, 599, 582, 571, 558, 550, 550, 560, 565, 569, 569, 573, 571, 575, 577, 586, 591, 564, 560, 548, 540, 539, 541, 542, 530, 520, 506, 507, 508, 504, 498, 496, 504, 507, 504, 497, 493, 497, 503, 504, 498, 495, 496, 498, 495, 491, 491, 495, 495, 492, 487, 489, 492, 490, 490, 489, 493, 499, 496, 491, 493, 500, 513, 526, 534, 532, 540, 556, 565, 547, 542, 541, 541, 536, 541, 534, 538, 530, 540, 553, 553, 559, 567, 582, 578, 573, 572, 572, 552, 550, 543, 549, 543, 539, 533, 531, 523, 512,
//                505, 508, 511, 513, 505, 500, 500, 503, 516, 531, 552, 581, 582, 591, 597, 585, 595, 586, 564, 569, 558, 553, 554, 559, 568, 590, 590, 587, 556, 546, 541, 540, 544, 540, 541, 575, 737, 755, 695, 693, 690, 664, 688, 691, 691, 664, 676, 633, 592, 581, 572, 578, 610, 605, 612, 645, 710, 821, 764, 681, 680, 650, 604, 594, 584, 583, 605, 677, 758, 741, 719, 729, 725, 662, 686, 676, 690, 701, 649, 691, 652, 676, 659, 666, 676, 759, 729, 737, 693, 694, 651, 644, 635, 651, 650, 646, 634, 649, 638, 625, 625, 637, 653, 638, 657, 654, 705, 704, 731, 687, 690, 666, 663, 627, 621, 598, 600, 599, 628, 665, 690, 703, 717, 672, 672, 651, 628, 598, 592, 597, 616, 612, 615, 625, 655, 642, 656, 650, 651, 613, 608, 590, 589, 584, 586, 589, 599, 606, 618, 600, 582, 574, 570, 574, 578, 568, 559, 596, 657, 730, 655, 659, 619, 594, 576, 567, 565, 578, 580, 601, 630, 694, 803, 729, 702, 772, 681, 683, 706, 655, 616, 601, 566, 561, 580, 648, 688, 703, 708, 729, 692, 700, 672, 640, 617, 600, 565, 555, 547, 554, 557, 579, 596, 627, 646, 633, 651, 629, 598, 594, 580, 576, 580, 572, 568, 560, 564, 561, 560, 550, 547, 540, 539, 536, 532, 530, 528, 533, 532, 526, 528, 540, 569, 584, 600, 596, 596, 575, 571, 562, 560, 553, 541, 534, 537, 541, 537, 533, 529, 529, 523, 529, 527, 531, 523, 520, 524, 529, 525, 521, 518, 517, 521, 521, 520, 522, 530, 535, 546, 556, 570, 563, 559, 543, 543, 545, 541, 530, 526, 528, 533, 537, 540, 547, 561, 583, 590, 587, 587, 582, 572, 567, 567, 557, 554, 546, 551, 563, 562, 578, 594, 642, 665, 677, 676, 649, 601, 582, 571, 568, 575, 565, 565, 559, 555, 549, 556, 572, 578, 596, 605, 601, 615, 606, 594, 593, 580, 570, 552, 550, 544, 544, 541, 548, 573, 587, 588, 588, 584, 569, 575, 563, 566, 571, 575, 569, 554, 542, 541, 539, 535, 530, 531, 537, 550, 573, 680, 750, 665, 646, 648, 673, 663, 606, 594, 570, 559, 557, 553, 549, 563, 597, 689, 743, 687, 708, 640, 686, 619, 629, 633, 645, 629, 601, 594, 598, 591, 596, 581, 583, 623, 653, 666, 647, 625, 608, 574, 553, 539, 531, 535, 547, 592, 725, 809, 720, 711, 807, 814, 825, 818, 844, 780, 717, 602, 618, 587, 614, 722, 774, 776, 770, 697, 679, 654, 636, 623, 619, 661, 694, 708, 701, 701, 704, 693, 678, 683, 696, 710, 727, 709, 672, 622, 595, 594, 599, 638, 708, 791, 843, 799, 774, 785, 768, 812, 813, 816, 804, 795, 756, 762, 791, 810, 800, 760, 740, 839, 966, 751, 935, 717, 796, 665, 658, 690, 743, 841, 954, 816, 834, 805, 860, 867, 871, 834, 939, 766, 757, 695, 708, 767, 898, 941, 807, 840, 848, 854, 834, 935, 745, 900,
//                732, 706, 689, 682, 780, 811, 843, 822, 783, 809, 788, 768, 708, 690, 671, 694, 721, 705, 719, 719, 740, 733, 689, 700, 709, 735, 707, 729, 709, 646, 643, 623, 661, 727, 718, 699, 635, 622, 605, 601, 588, 607, 677, 676, 738, 709, 681, 641, 595, 591, 590, 601, 636, 700, 728, 721, 659, 642, 609, 604, 601, 597, 582, 572, 561, 558, 565, 583, 620, 812, 818, 844, 875, 842, 789, 729, 679, 625, 602, 574, 567, 572, 643, 915, 884, 688, 870, 799, 798, 703, 763, 684, 626, 615, 608, 611, 612, 612, 607, 604, 596, 574, 574, 583, 606, 617, 666, 741, 843, 790, 748, 754, 736, 713, 678, 646, 614, 627, 664, 716, 774, 800, 788, 769, 734, 722, 746, 796, 862, 914, 827, 971, 943, 867, 774, 709, 691, 665, 690, 724, 958, 907, 1017, 978, 872, 800, 726, 714, 689, 701, 753, 741, 856, 925, 918, 913, 853, 834, 782, 741, 675, 670, 659, 644, 672, 717, 812, 838, 824, 769, 734, 694, 677, 667, 674, 683, 705, 721, 724, 722, 725, 683, 656, 672, 678, 702, 706, 726, 735, 710, 708, 693, 716, 708, 713, 739, 797, 811, 761, 752, 751, 707, 702, 697, 765, 856, 776, 828, 839, 810, 836, 825, 800, 726, 734, 711, 665, 658, 654, 726, 867, 972, 1000, 987, 953, 901, 834, 764, 709, 680, 694, 712, 772, 812, 888, 898, 854, 789, 752, 730, 701, 689, 682, 725, 738, 785, 852, 856, 894, 869, 751, 752, 679, 657, 636, 619, 609, 605, 605, 591, 595, 601, 643, 697, 728, 722, 706, 727, 725, 728, 754, 766, 752, 718, 685, 657, 631, 616, 596, 590, 581, 564, 562, 569, 625, 1312, 1090, 709, 979, 933, 904, 860, 767, 677, 663, 660, 662, 659, 662, 624, 625, 611, 632, 666, 722, 784, 792, 774, 740, 704, 701, 684, 680, 677, 671, 636, 640, 667, 714, 760, 752, 749, 739, 723, 702, 698, 708, 720, 743, 730, 766, 766, 782, 743, 744, 733, 685, 689, 676, 682, 691, 724, 779, 793, 756, 777, 806, 801, 785, 705, 733, 687, 672, 651, 656, 677, 730, 761, 776, 786, 744, 782, 718, 686, 695, 660, 645, 673, 687, 725, 733, 753, 745, 744, 720, 701, 666, 672, 664, 682, 699, 699, 685, 666, 648, 627, 608, 591, 583, 583, 603, 669, 898, 721, 1089, 955, 972, 919, 833, 757, 709, 678, 684, 699, 697, 732, 761, 812, 790, 807, 795, 739, 733, 718, 708, 701, 707, 720, 724, 715, 754, 734, 736, 735, 727, 724, 688, 679, 671, 668, 660, 665, 674, 677, 691, 703, 722, 710, 714, 698, 706, 700, 685, 694, 694, 709, 720, 706, 712, 718, 715, 690, 689, 683, 695, 694, 677, 689, 681, 680, 688, 694, 709, 694, 707, 701, 691, 688, 688, 703, 730, 716, 718, 680, 625, 616, 594, 596, 624, 721, 851, 858, 808, 687, 766, 686, 671, 665, 649, 657, 665, 747, 858, 845
//        };
        double[] intervals = new double[] {
                746,750,758,768,759,754,748,749,750,769,754,755,762,760,751,760,771,761,768,776,782,786,781,788,793,791,762,755,768,763,761,747,756,762,767,766,762,775,781,800,795,796,779,778,787,791,788,785,798,811,805,797,804,802,783,771,770,772,785,790,779,774,791,791,778,761,775,768,763,764,779,784,786,774,779,782,776,775,785,778,760,759,767,776,791,788,788,798,797,787,766,779,781,791,796,790,805,822,800,802,805,798,785,779,783,791,808,805,782,768,767,777,770,765,771,791,792,784,792,793,796,784,786,798,803,794,779,785,787,789,801,809,791,789,798,795,784,775,788,795,806,791,787,807,811,810,791,801,807,788,796,779,778,787,791,788,785,798,811,805,797,804,802,783,771,770,772,785,790,779,774,791,791,778,761,775,768,763,764, 762,755,768,763,761,747,756,762
        };
        Histogram histogram = new Histogram(intervals, 50);
        System.out.println(histogram.getSI());
        System.out.println(System.currentTimeMillis() - t);
    }


}
